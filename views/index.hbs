<div class="form-container">
    <div class="card">
        <div class="card-header">
            <h1>üì§ Enviar Mensaje</h1>
        </div>
        
        <form id="messageForm">
            <div class="form-group">
                <label for="phoneNumber">üìû N√∫mero de Tel√©fono</label>
                <input 
                    type="tel" 
                    id="phoneNumber" 
                    name="phoneNumber"
                    placeholder="Ej: 34612345678"
                    required
                >
                <small>Incluye el c√≥digo de pa√≠s sin el s√≠mbolo +</small>
            </div>

            <div class="form-group">
                <label for="message">üí¨ Mensaje</label>
                <textarea 
                    id="message" 
                    name="message"
                    placeholder="Escribe tu mensaje aqu√≠..."
                    required
                ></textarea>
            </div>

            <button type="submit" class="btn-send">
                üì§ Enviar
            </button>
        </form>

        <div class="status" id="connectionStatus">
            <span id="statusText">Verificando conexi√≥n...</span>
            <button id="logoutBtn" class="btn-logout" style="display:none;margin-left:1rem;">Cerrar sesi√≥n</button>
        </div>

        <div class="result" id="resultContainer" style="display: none;">
            <span id="resultMessage"></span>
        </div>
    </div>


    <div class="info">
        <h3>‚ÑπÔ∏è Instrucciones</h3>
        <ul>
            <li>‚úì Incluye el c√≥digo de pa√≠s</li>
            <li>‚úì El n√∫mero debe estar en WhatsApp</li>
            <li>‚úì Escanea el c√≥digo QR para conectar</li>
        </ul>
    </div>
</div> 

<script>
document.addEventListener('DOMContentLoaded', function() {
    const logoutBtn = document.getElementById('logoutBtn');
    const statusText = document.getElementById('statusText');
    if (logoutBtn) {
        // Mostrar el bot√≥n solo si est√° conectado
        function updateLogoutBtn() {
            if (statusText && statusText.textContent.trim().toLowerCase().includes('conectado')) {
                logoutBtn.style.display = '';
            } else {
                logoutBtn.style.display = 'none';
            }
        }
        updateLogoutBtn();
        // Tambi√©n actualizar cuando cambie el estado
        setInterval(updateLogoutBtn, 2000);
        logoutBtn.addEventListener('click', async function() {
            if (!confirm('¬øSeguro que deseas cerrar la sesi√≥n y eliminar la cuenta de este servidor?')) return;
            logoutBtn.disabled = true;
            logoutBtn.textContent = 'Cerrando...';
            try {
                const resp = await fetch('/api/clear', { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    alert('Sesi√≥n cerrada y eliminada completamente.');
                    window.location.href = '/auth';
                } else {
                    alert(data.error || 'No se pudo cerrar la sesi√≥n.');
                }
            } catch (e) {
                alert('Error de red al cerrar sesi√≥n.');
            } finally {
                logoutBtn.disabled = false;
                logoutBtn.textContent = 'Cerrar sesi√≥n';
            }
        });
    }
});
</script>